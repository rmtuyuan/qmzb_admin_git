<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit" />
    <link rel="icon" href="">
    <title>全民直播管理系统-主播审核</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/gimi.css">
    <link rel="stylesheet" href="css/my_style.css">
    <link rel="stylesheet" href="css/checkbix.min.css">

    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <style>
        .not-agree-people-modal textarea {
            width: 80%;
            height: 100%;
            font-size: 16px;
            border-radius: 5px;
            outline: 0;
            border: 1px solid #666;
            padding-left: 8px;
            
        }

        .big-img-box {
            margin: 0 auto;
            padding: 10px;
            height: 100%;
            width: 100%;
            background: #000;
            position: relative;
            text-align: center;
            background-size: 100% 100%;

            
        }

        .big-img-box img {
            display: inline-block;
            height: 100%;
           
        }
         .big-img-box img:hover{
             transform: scale(3);
         }
        .close-big-img-box-modal {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            z-index: 20;
        }

        .box {
            height: 40px;
            line-height: 40px;
            position: relative;


            transform: translate(-50%, -50%);
            text-align: center;
            margin-top: 30px;
        }

        td img {
            margin-top: 5px;
            
        }
    </style>
</head>

<body>
    <section>
        <!--左侧边栏-->
        <div class="left-side">

        </div>

        <!--右边主体内容-->
        <div class="main">
            <!--头部-->
            <div class="main-header"></div>

            <div class="main-content main-gray" style="padding-bottom:0;margin-top:44px;">
                <h3 class="mb-nav" style=""> <a href="">主播审核</a> </h3>
                <div class="content">
                    <div class="content-header">


                        <div class="content-search">
                            <form class="search-box" id="">

                                <a href="#" data-showmodal="add-people-modal" data-item='0' class="padd_search_btn" style="margin-right:10px; background:#369;width:100px;">待审核</a>
                                <a href="#" data-showmodal="add-people-modal" data-item='1' class="padd_search_btn" style="margin-right:10px; background:#369;width:100px;">审核已通过</a>
                                <a href="#" data-showmodal="add-people-modal" data-item='-1' class="padd_search_btn" style="margin-right:10px; background:#369;width:100px;">审核未通过</a>
                        </div>
                        </form>
                    </div>
                </div>
                <table class="table gimi-table table-striped" id="tableSort">
                    <thead>
                        <tr>

                            <th class="table-sort sort-both sort-down" type="number">序号</th>
                            <th>用户ID</th>
                            <th>昵称</th>
                            <th>审核状态</th>
                            <th>真实姓名</th>
                            <th>身份证号</th>
                            <th>身份照片</th>
                            <th>手机号</th>
                            <th>申请时间</th>
                            <th>处理时间</th>
                            <th>拒绝原因</th>
                            <th>操作</th>
                        </tr>
                    </thead>

                    <tbody id="tbody">
                       
                    </tbody>
                </table>
                <div class="content-footer box">

                </div>
            </div>
        </div>


        </div>
        </div>
    </section>

    <!--弹窗-->
    <div class="modal-log-box agree-people-modal">
        <div class="modal-cont">
            <p>确定通过该审核吗？</p>

            <div class="modal-btn-box">
                <a href="#" class="padd-agree-btn" data-id="" data-status="1">确定</a>
                <a href="#" class="quit-modal">取消</a>
            </div>
        </div>
    </div>
    <div class="modal-log-box not-agree-people-modal">
        <div class="modal-cont">
            <p>确定拒绝该审核吗？</p>
            <p style="height:100px; margin-bottom:10px;">
                <textarea name="" id="" cols="30" class="not-pass-refusereason" rows="10"></textarea>
            </p>
            <div class="modal-btn-box">
                <a href="#" class="padd-agree-btn not-pass-btn" data-id="" data-status="-1">确定</a>
                <a href="#" class="quit-modal">取消</a>
            </div>
        </div>
    </div>
    <div class="modal-log-box  big-img-box-modal">
        <div class="modal-cont" style="top:20%; background:rgba(0,0,0,1);z-index:200; width:70%; margin-left:-35%; height:95%;top:4%;">
            <div class="big-img-box" style="">
                <img src="" alt="">
            </div>
            <div class="modal-btn-box">


            </div>

        </div>
        <div class="close-big-img-box-modal">

        </div>

    </div>
    <!--弹窗-->

    <div class="modal-info">
        <div class="modal-content">
            <div class="other-modal-info">
                <p class="info-text" style="font-size:16px;">

                </p>
                <p style="display:none;">

                </p>
            </div>

        </div>
        <div class="close-modal">

        </div>
    </div>

    <!--弹窗-->
    <!--JS-->
    <script src="http://cdn.bootcss.com/jquery/1.12.4/jquery.min.js" type="text/javascript"></script>
    <script>
        window.jQuery || document.write('<script src="js/jquery-1.12.4.min.js"><\/script>')
    </script>
    <script src="js/bootstrap.js"></script>
    <script src="js/checkbix.min.js"></script>
    <script src="js/tableSort.js"></script>
    <script src="js/nomoJS.js"></script>
    <script src="js/gimi.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/fetch.js"></script>
    <script src="js/paging.js"></script>
    <script src="js/jz_admin.js"></script>
    <script>
        var server = "http://192.168.1.37:8081/";
        var Anchor_audit = {
            init: function () {
                this.DataLoad();

            },
            li_length: null,
            pagesFuc: function (page_number, form) {

                fetch(server + "check/getCheckAnchorList", {
                    method: 'POST',
                    //      headers: { 'Accept': 'application/json',
                    //      'Content-Type': 'application/json'},
                    mode: 'cors',
                    cache: 'default',
                    body: form
                }).then((response) => response.json()).then(function (data) {
                    //console.log(data);
                    if (data.code == 200) {

                        var li_leng = data.data.totalCount;

                        //分页
                        var setTotalCount = li_leng;
                        var all_pages = parseInt(li_leng % 10 == 0 ? li_leng / 10 : li_leng / 10 + 1);
                        $('.content-footer').paging({
                            initPageNo: 1, // 初始页码
                            totalPages: all_pages, //总页数
                            totalCount: '合计' + setTotalCount + '条数据', // 条目总数
                            slideSpeed: 600, // 缓动速度。单位毫秒
                            jump: false, //是否支持跳转
                            callback: function (page) { // 回调函数
                                //刷新页面
                                //console.log(page)
                                Anchor_audit.DataLoad(page_number, form);
                            }
                        });


                    }
                });

            },
            DataInit: function (page_number) {
                var form = new FormData();
                //  page=1     familyid=1


                form.append("status", "0"); // 
                form.append("page", page_number); // 
                this.pagesFuc(page_number, form);
            },

            DataLoad: function (page_number, form) {

                fetch(server + "check/getCheckAnchorList", {
                    method: 'POST',
                    //      headers: { 'Accept': 'application/json',
                    //      'Content-Type': 'application/json'},
                    mode: 'cors',
                    cache: 'default',
                    body: form
                }).then((response) => response.json()).then(function (data) {
                    //console.log(data);
                    if (data.code == 200) {
                        var tr_fram = document.createDocumentFragment();
                        var li_leng = data.data.list.length;


                        for (var i = 0; i < li_leng; i++) {
                            var element = data.data.list[i];
                            var tr = document.createElement("tr");

                            var dateParms = element.createTime + "";
                            var dateParms1 = element.updateTime + "";
                            if (dateParms instanceof Date) {
                                var datatime = dateParms;
                                var datatime1 = dateParms1;
                            }

                            //判断是否为字符串

                            if ((typeof dateParms == "string") && dateParms.constructor == String) {

                                //将字符串日期转换为日期格式

                                var datatime = new Date(parseInt(dateParms)*1000);
                                var datatime1 = dateParms1==0?0: new Date(parseInt(dateParms1)*1000);

                            }
                           
                            $(tr).html(
                                `
                                <td>${element. id}</td>
                              
                                   <td>${element.number}</td>
                                <td>${element.nick_name}</td>
                              
                                   <td>${element.status==0?"未审核":element.status==1?"已通过":"未通过"}</td>
                                      <td>${element.realName}</td>
                                        <td>${element.idCard}</td>
                                 <td style=''> <img class='user-edit' data-showmodal='big-img-box-modal' src="${element.picIdFront}" alt=""> <img class='user-edit' data-showmodal='big-img-box-modal' src="${element.picIdBack}" alt=""></td>
                                   <td>${element.mobile}</td>
                               
                                   <td>${Anchor_audit.timeChange(datatime)}</td>
                                      <td>${datatime1==0?"--":Anchor_audit.timeChange(datatime1) }</td>
                               <td class="text-blue">${element.refuseReason == ""?"---":element.refuseReason}</td>
                                <td class="membership-edit">
                                    ${element.status==0?
                                    
                                    ` <a href="#" data-showmodal='agree-people-modal' data-id=${element.id} class="user-edit padd-agree-yes-not" data-modalclass="padd-agree-btn" style="font-size:14px;">【通过】</a>  <a  class="user-edit padd-agree-yes-not" data-showmodal='not-agree-people-modal'  data-id=${element.id} data-modalclass="padd-agree-not-btn" style="font-size:14px;">【拒绝】</a>`:"--"      
                                      }
                                </td>`
                            );
                            tr_fram.appendChild(tr);
                        }

                        $("#tbody").html(tr_fram);

                    }
                });


            },
            timeChange:function(datatime){
                var timecount= `${datatime.getFullYear()}-${datatime.getMonth()+1>=10? datatime.getMonth()+1:"0"+ (datatime.getMonth()+1)}-${datatime.getDate()>=10? datatime.getDate():"0"+ datatime.getDate()} ${datatime.getHours()>=10? datatime.getHours():"0"+ datatime.getHours()}:${datatime.getMinutes()>=10? datatime.getMinutes():"0"+ datatime.getMinutes()}:${datatime.getSeconds()>10? datatime.getSeconds():"0"+ datatime.getSeconds()}`;
                return timecount;
            },
            searchSome: function () {
                //上面搜索框
                $(".padd_search_btn").click(function (e) {
                    e.preventDefault();

                    var status = $(this).data("item");


                    var form = new FormData();

                    form.append("status", status); // 


                    form.append("page", 1); // 
                    Anchor_audit.pagesFuc(1, form);
                });

            },
            Atte_msg: function (uid) {
                var form = new FormData();
                form.append("uid", uid); // 

                fetch(server + "check/getAuthentication", {
                    method: 'POST',
                    //      headers: { 'Accept': 'application/json',
                    //      'Content-Type': 'application/json'},
                    mode: 'cors',
                    cache: 'default',
                    body: form
                }).then((response) => response.json()).then(function (data) {
                    //console.log(data);
                    if (data.code == 200) {
                        $(".img-logo-src").attr("src", data.data.icon);
                        $('.number-in').html(data.data.number);
                        $('.nickName-in').html(data.data.nickName);
                        $(".mobile-in").html(data.data.mobile);

                        $(".img-logo-src").attr("src", data.data.icon);
                        $('.gender-in').html(data.data.userAuthentication.gender == 0 ? "保密" : data.data
                            .userAuthentication.gender == 1 ? "男" : "女");
                        $('.age-in').html(data.data.userAuthentication.age);
                        $(".realName-in").html(data.data.userAuthentication.realName);
                        $(".idCard-in").html(data.data.userAuthentication.idCard);
                        $(".picIdFront-in").css("background", " url(" + data.data.userAuthentication.picIdFront +
                            ") no-repeat");
                        $(".picIdBack-in").css("background", " url(" + data.data.userAuthentication.picIdBack +
                            ") no-repeat");
                    }
                });

            },

            Edit_agree: function () {
                // 同意或者驳回
                $("#tableSort").on("click", ".padd-agree-yes-not", function (e) {
                    e.preventDefault();

                    $("." + $(this).data("showmodal")).find(".padd-agree-btn").attr("data-id", $(this).data(
                        "id"));


                })
                $(".padd-agree-btn").click(function (e) {
                    e.preventDefault();

                    var id = $(this).data("id");
                    var status = $(this).data("status");
                    var form = new FormData();
                    if ($(this).hasClass("not-pass-btn")) {
                        //拒绝 
                        if ($(".not-pass-refusereason").val().length > 0) {
                            form.append("id", id); // 
                            form.append("status", status); // 
                            form.append("reason", $(".not-pass-refusereason").val()); // 
                            fetch(server + "check/checkAnchor", {
                                method: 'POST',

                                mode: 'cors',
                                cache: 'default',
                                body: form
                            }).then((response) => response.json()).then(function (data) {
                                //console.log(data);
                                if (data.code == 200) {
                                    $('.modal-log-box').hide();
                                    showInfo("操作成功");
                                    setTimeout(function () {
                                        window.location.reload();
                                    }, 300);


                                } else {
                                    showInfo(data.message)
                                }
                            });
                        } else {
                           alert("请填写拒绝原因");
                        }
                    } else {
                        form.append("id", id); // 
                        form.append("status", status); // 
                        fetch(server + "check/checkAnchor", {
                            method: 'POST',

                            mode: 'cors',
                            cache: 'default',
                            body: form
                        }).then((response) => response.json()).then(function (data) {
                            //console.log(data);
                            if (data.code == 200) {
                                $('.modal-log-box').hide();
                                showInfo("操作成功");
                                setTimeout(function () {
                                    window.location.reload();
                                }, 300);


                            } else {
                                showInfo(data.message)
                            }
                        });
                    }

                });

            },
            ClickImgBig: function () {
                //点击图片放大
                $("#tbody").on("click", "img", function () {
                    //点击图片 
                    var src = $(this).attr("src");
                    // $(".big-img-box").css("background","url("+src+") no-repeat").css("background-size","100% 100%");
                    $(".big-img-box img").attr("src", src);
                    $(".big-img-box-modal").show();

                });
            }
        }
        $(function () {
            $(".radio-box input").click(function () {
                $("." + $(this).data("item")).show().siblings(".img-file-box-con").hide();
            });

            //点击弹窗
            $(".close-big-img-box-modal").click(function () {
                $('.modal-log-box').hide();
            });
            $("#tbody").on("click", ".user-edit", function (e) {


                //
                e.preventDefault();
                $("." + $(this).data("showmodal")).show();
            });
            $(".quit-modal").click(function (e) {
                //
                e.preventDefault();
                $('.modal-log-box').hide();
            });


            // Membership.DataLoad();

            Anchor_audit.ClickImgBig();
            Anchor_audit.DataInit(1);

            Anchor_audit.searchSome();
            Anchor_audit.Edit_agree();
            // Anchor_audit.searchSome();
            // Anchor_audit.Edit_agree();
        });
    </script>

</body>

</html>